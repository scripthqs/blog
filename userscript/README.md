# 网络请求拦截器 - 油猴插件

这是一个功能强大的油猴插件，可以劫持网站的网络请求并修改入参和参数数据。

## 功能特性

### 🔧 核心功能

- **网络请求拦截**: 支持拦截 Fetch API 和 XMLHttpRequest
- **参数修改**: 可以修改请求 URL、请求头、请求体等参数
- **规则管理**: 支持创建、编辑、删除拦截规则
- **实时配置**: 提供可视化界面进行配置管理
- **日志记录**: 详细记录所有拦截和修改操作

### 🎯 拦截能力

- **URL 模式匹配**: 使用正则表达式匹配目标 URL
- **HTTP 方法过滤**: 支持按 GET、POST、PUT 等方法过滤
- **请求头修改**: 添加、修改或删除 HTTP 请求头
- **请求体修改**: 修改 POST/PUT 等请求的 body 数据
- **URL 重定向**: 修改请求的目标 URL

### 📊 管理界面

- **浮动控制按钮**: 页面右上角的便捷访问按钮
- **规则配置面板**: 可视化管理所有拦截规则
- **实时日志查看**: 查看拦截操作的详细日志
- **一键启用/禁用**: 快速开启或关闭拦截功能

## 安装方法

1. 确保已安装 [Tampermonkey](https://www.tampermonkey.net/) 浏览器扩展
2. 打开 Tampermonkey 管理面板
3. 点击"添加新脚本"
4. 将 `network-interceptor.user.js` 文件内容复制到编辑器中
5. 保存脚本（Ctrl+S）

## 使用方法

### 基本操作

1. 安装插件后，访问任意网站
2. 在页面右上角会出现一个蓝色的齿轮图标 🔧
3. 点击图标打开控制面板
4. 勾选"启用拦截器"来激活功能

### 添加拦截规则

1. 在控制面板中点击"添加规则"按钮
2. 填写规则信息：
   - **规则名称**: 便于识别的名称
   - **URL 模式**: 使用正则表达式匹配目标 URL（如 `.*api.*` 匹配包含"api"的 URL）
   - **HTTP 方法**: 选择要拦截的请求方法
   - **修改请求**: 勾选后可以修改请求参数
3. 配置请求修改选项：
   - **修改 URL**: 重定向到新的 URL
   - **修改请求体**: 替换请求的 body 数据
   - **添加请求头**: 添加或修改 HTTP 请求头
4. 点击"添加"保存规则

### 查看日志

1. 点击控制面板中的"查看日志"按钮
2. 可以查看最近的拦截操作记录
3. 使用"清空日志"按钮清理历史记录

## 使用示例

### 示例 1: 修改 API 请求头

```
规则名称: 添加认证头
URL模式: .*api.*
HTTP方法: ALL
修改请求: ✓
添加请求头: Authorization: Bearer your-token-here
```

### 示例 2: 重定向 API 请求

```
规则名称: API重定向
URL模式: .*old-api.*
HTTP方法: ALL
修改请求: ✓
修改URL: https://new-api.example.com/api
```

### 示例 3: 修改 POST 请求体

```
规则名称: 修改登录数据
URL模式: .*login.*
HTTP方法: POST
修改请求: ✓
修改请求体: {"username":"admin","password":"newpassword"}
```

## 高级配置

### URL 模式正则表达式示例

- `.*` - 匹配所有 URL
- `.*api.*` - 匹配包含"api"的 URL
- `^https://example\.com/api/.*` - 匹配特定域名的 API
- `.*\.json$` - 匹配以.json 结尾的 URL

### 请求体格式

- **JSON 格式**: `{"key":"value"}`
- **表单格式**: `key1=value1&key2=value2`
- **XML 格式**: `<root><item>value</item></root>`

## 注意事项

⚠️ **重要提醒**:

- 此插件仅用于学习和测试目的
- 请遵守相关网站的使用条款和法律法规
- 不要用于恶意攻击或非法用途
- 建议在测试环境中使用

## 技术实现

### 拦截机制

- **Fetch API 拦截**: 重写 `window.fetch` 方法
- **XHR 拦截**: 重写 `XMLHttpRequest.prototype.open` 和 `send` 方法
- **规则匹配**: 使用正则表达式进行 URL 模式匹配
- **参数修改**: 在请求发送前修改相关参数

### 数据存储

- 使用 Tampermonkey 的 `GM_setValue` 和 `GM_getValue` API
- 配置数据和日志数据持久化存储
- 支持导入/导出配置

## 故障排除

### 常见问题

1. **插件不生效**: 检查是否已启用拦截器，确认规则配置正确
2. **规则不匹配**: 检查 URL 模式正则表达式是否正确
3. **修改失败**: 确认目标网站没有使用其他反拦截机制

### 调试方法

1. 打开浏览器开发者工具的控制台
2. 查看以 `[网络拦截器]` 开头的日志信息
3. 使用"查看日志"功能查看详细操作记录

## 更新日志

### v1.0.0

- 初始版本发布
- 支持 Fetch 和 XHR 请求拦截
- 提供可视化配置界面
- 实现规则管理和日志记录功能

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

---

**免责声明**: 本工具仅供学习和研究使用，使用者需自行承担使用风险，开发者不承担任何责任。

