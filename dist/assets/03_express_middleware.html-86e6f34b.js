import{_ as n,o as s,c as a,f as t}from"./app-007a9be1.js";const p="data:image/png;base64,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",e="/assets/middleware2-68dc5506.png",o={},c=t('<h1 id="中间件" tabindex="-1"><a class="header-anchor" href="#中间件" aria-hidden="true">#</a> 中间件</h1><h2 id="含义" tabindex="-1"><a class="header-anchor" href="#含义" aria-hidden="true">#</a> 含义</h2><p>中间件（middleware）可以理解为业务流程的中间处理环节。如生活中吃一般炒青菜，大约分为如下几步骤：</p><p><img src="'+p+'" alt="中间件1"> express 中，当一个<strong>请求到达的服务器之后，可以在给客户响应之前</strong>连续调用<strong>多个</strong>中间件，来对本次请求和返回响应数据进行<strong>处理</strong>。</p><p><img src="'+e+`" alt="中间件2"></p><p>中间件的本质是传递给 express 的一个回调函数</p><p>这个回调函数接受三个参数：</p><ul><li>请求对象（request 对象）</li><li>响应对象（response 对象）</li><li>next 函数（在 express 中定义的用于执行下一个中间件的函数）</li></ul><h2 id="中间件作用" tabindex="-1"><a class="header-anchor" href="#中间件作用" aria-hidden="true">#</a> 中间件作用</h2><ul><li>执行任何代码</li><li>更改请求（request）和响应（response）对象</li><li>结束请求-响应周期（返回数据）</li><li>调用栈中的下一个中间件</li></ul><p>如果当前中间件功能没有结束请求-响应周期，则必须调用 next()将控制权传递给下一个中间件功能，否则，请求将被挂起</p><h2 id="中间件的分类" tabindex="-1"><a class="header-anchor" href="#中间件的分类" aria-hidden="true">#</a> 中间件的分类</h2><p>中间件可以分类可分如下几类：</p><ol><li>内置中间件，也就是 express 本身自带无需 npm 安装</li><li>第三方中间件</li><li>自定义中间件，开发者自己编写的（<strong>中间件的本质其实就是一个函数</strong>）</li></ol><p>如果从使用层面去考虑，中间件可以划分为：</p><ol><li>应用级别中间件（通过 app.get/post/use 等方法绑定到 app 实例的中间件）</li><li>路由级别中间件（绑定到 express.Router()上的中间件）</li></ol><h2 id="use-最基本用法" tabindex="-1"><a class="header-anchor" href="#use-最基本用法" aria-hidden="true">#</a> use 最基本用法</h2><p>express 主要提供了两种方式：</p><ul><li>app/router.use</li><li>app/router.methods</li></ul><p>可以是 app，也可以是 router</p><ul><li>通过 use 方法注册的中间件是最普通的/简单的中间件</li><li>通过 use 注册的中间件, 无论是什么请求方式都可以匹配上</li><li>methods 指的是常用的请求方式，比如： app.get 或 app.post 等</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 1.注册普通的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;normal middleware 01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="use-匹配路径" tabindex="-1"><a class="header-anchor" href="#use-匹配路径" aria-hidden="true">#</a> use 匹配路径</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 2.注册路径匹配的中间件：路径匹配的中间件是不会对请求方式(method)进行限制</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/home&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;home data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="指定请求方法注册中间件" tabindex="-1"><a class="header-anchor" href="#指定请求方法注册中间件" aria-hidden="true">#</a> 指定请求方法注册中间件</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 3.注册中间件: 对path/method都有限制</span>
<span class="token comment">// app.method(path, middleware)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/home&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;match /home get method middleware&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;home data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;match /users post method middleware&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;create user success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="注册多个中间件" tabindex="-1"><a class="header-anchor" href="#注册多个中间件" aria-hidden="true">#</a> 注册多个中间件</h3><p>可以将不同的功能拆分成中间件，例如</p><ol><li>验证身份</li><li>查询数据库</li><li>返回数据</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 4.注册多个中间件</span>
<span class="token comment">// app.get(路径, 中间件1, 中间件2, 中间件3)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
  <span class="token string">&quot;/home&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;match /home get middleware01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//要想后面的中间件需要调用next</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;match /home get middleware02&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;match /home get middleware03&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;match /home get middleware04&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="解析-body-参数" tabindex="-1"><a class="header-anchor" href="#解析-body-参数" aria-hidden="true">#</a> 解析 body 参数</h2><p>在客户端发送 post 请求时，会将数据放到 body 中：</p><ul><li>客户端可以通过 json 的方式传递</li><li>也可以通过 form 表单的方式传递</li></ul><h3 id="express-json" tabindex="-1"><a class="header-anchor" href="#express-json" aria-hidden="true">#</a> express.json()</h3><p>express.json 是 express 内置中间件，可以用来处理 json 数据，对 body 进行解析</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 该中间件相当于做了一下操作</span>

<span class="token comment">//处理请求的json数据</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> jsonInfo <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      req<span class="token punctuation">.</span>body <span class="token operator">=</span> jsonInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="express-urlencoded" tabindex="-1"><a class="header-anchor" href="#express-urlencoded" aria-hidden="true">#</a> express.urlencoded()</h3><p>解析传递过来 urlencoded 的时候,可以使用 express 内置的中间件或者使用 body-parser 来完成</p><ul><li>默认使用的 node 内置 querystring 模块（有点过时了）</li><li>可以使用 express.urlencoded 中间件，使用第三方 qs 库（推荐）</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解析客户端传递过来的json</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解析客户端传递过来的urlencoded</span>
<span class="token comment">// 解析传递过来urlencoded的时候, 默认使用的node内置querystring模块</span>
<span class="token comment">// { extended: true }: 代表不再使用内置的querystring, 而是使用qs第三方库</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="记录请求日志中间件-morgan" tabindex="-1"><a class="header-anchor" href="#记录请求日志中间件-morgan" aria-hidden="true">#</a> 记录请求日志中间件 morgan</h2><p>可以使用 express 官网开发的第三方库 morgan 将请求日志记录下来</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i morgan
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> morgan <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;morgan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建app对象</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 应用第三方中间件</span>
<span class="token keyword">const</span> writeStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">&quot;./logs/access.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">&quot;combined&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">stream</span><span class="token operator">:</span> writeStream <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="文件上传中间件-multer" tabindex="-1"><a class="header-anchor" href="#文件上传中间件-multer" aria-hidden="true">#</a> 文件上传中间件 multer()</h2><p>可以使用 express 提供的中间件 multer 来完成上传文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i multer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;multer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 应用一个express编写第三方的中间件</span>
<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// dest: &quot;./uploads&quot;, //指定上传文件保存的路径</span>
  <span class="token literal-property property">storage</span><span class="token operator">:</span> multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">//目的文件夹</span>
    <span class="token function">destination</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;./uploads&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//对文件名进行处理，添加后缀名，自定义文件名等</span>
    <span class="token function">filename</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 上传单文件: singer方法</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/avatar&quot;</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&quot;avatar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;头像文件上传成功~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 上传多文件:array方法</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/photos&quot;</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token string">&quot;photos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;上传多张照片成功~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="multer-解析-form-data" tabindex="-1"><a class="header-anchor" href="#multer-解析-form-data" aria-hidden="true">#</a> multer()解析 form-data</h3><p>multer 帮助我们解析一些 form-data 中的普通数据，使用 any</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> formdata <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> formdata<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;登录成功, 欢迎回来~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="客户端发送请求传递参数" tabindex="-1"><a class="header-anchor" href="#客户端发送请求传递参数" aria-hidden="true">#</a> 客户端发送请求传递参数</h2><p>客户端传递到服务器参数的方法常见的是 5 种</p><ol><li>方式一：通过 get 请求中的 URL 的 params</li><li>方式二：通过 get 请求中的 URL 的 query</li><li>方式三：通过 post 请求中的 body 的 json 格式(用 express.json 中间件)</li><li>方式四：通过 post 请求中的 body 的 x-www-form-urlencoded 格式(用 express.urlencoded()中间件)</li><li>方式五：通过 post 请求中的 form-data 格式(用 multer 中间件)</li></ol><h3 id="传递参数-params-和-query" tabindex="-1"><a class="header-anchor" href="#传递参数-params-和-query" aria-hidden="true">#</a> 传递参数 params 和 query</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// http://localhost:8000/login/123/abc</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/login/:id/:name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">&quot;请求成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// http://localhost:8000/login?name=abc&amp;id=123</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">&quot;请求成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="响应数据" tabindex="-1"><a class="header-anchor" href="#响应数据" aria-hidden="true">#</a> 响应数据</h2><ol><li>end 方法：类似于 http 中的 response.end 方法，用法是一致的</li><li>json 方法：可以传入很多的类型：object、array、string、boolean、number、null 等，它们会被转换成 json 格式返回</li><li>status 方法：用于设置状态码，注意是一个函数，而不是属性赋值</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 编写中间件</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.res.end方法(比较少)</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;登录成功, 欢迎回来~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2.res.json方法(最多)</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;欢迎回来~&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 3.res.status方法: 设置http状态码</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">&quot;创建用户成功~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h2><p>在 express 中使用中间件时，需要注意以下几点：</p><ul><li>在定义路由<strong>之前</strong>注册中间件（除了错误中间件）</li><li>一个请求中可以连续调用多个中间件</li><li>在一次请求链路中，多个中间件与最终路由方法中，他们共用一份<code>req</code>与<code>res</code></li><li>每个中间件最后必须调用<code>next()</code>（除了错误中间件，必须要有参数传递）</li><li>不要在中间件的<code>next()</code>后继续写任何代码（没意义）</li></ul>`,62),u=[c];function i(l,r){return s(),a("div",null,u)}const d=n(o,[["render",i],["__file","03_express_middleware.html.vue"]]);export{d as default};
